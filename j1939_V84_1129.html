<!-- Version: V84_1129_official -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¼‹æš J1939 æ¸¬è©¦ä»‹é¢ - V84_1129</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet (OSM no key) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --bg-subtle: #f3f4f6;
      --border-subtle: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #ef4444;
      --fix-ok-bg: #ecfdf3;
      --fix-ok-br: #86efac;
      --fix-bad-bg:#f3f4f6;
      --fix-bad-br:#e5e7eb;

      /* Track colors (warm, not harsh) */
      --raw-red: #d06a5c;      /* warm soft red */
      --flt-blue: #3b82b1;     /* warm soft blue */
    }

    body{
      margin:0;
      background:var(--bg-subtle);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
    }

    /* HEADER */
    .app-header{
      background-image:url("header-bg.png");
      background-size:cover;
      background-position:center;
      padding:12px 18px;
    }
    .app-header-inner{
      max-width:1120px;
      margin:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .app-logo-title{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .app-logo{ height:56px; width:auto; }
    .app-title{
      font-size:20px;
      font-weight:700;
      color:#b91c1c;
    }

    .layout{
      max-width:1120px;
      margin:20px auto 32px;
      padding:0 16px;
    }

    /* TOOLBAR */
    .toolbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .toolbar-left{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .toolbar-right{
      display:flex;
      align-items:center;
      gap:8px;
    }

    .btn{
      padding:6px 14px;
      font-size:13px;
      border-radius:999px;
      cursor:pointer;
      border:1px solid var(--border-subtle);
      background:white;
      color:var(--text-main);
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--primary);
      color:white;
      border-color:var(--primary-dark);
    }
    .btn-outline{
      background:white;
      color:var(--text-muted);
    }
    .btn-ghost{ background:#f3f4f6; }
    .btn-ghost.active{
      background:#fde68a;
      border-color:#facc15;
      color:#854d0e;
    }
    .btn-clear{
      background:#fee2e2;
      color:#b91c1c;
      border-color:#fca5a5;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .status-chip{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border-subtle);
      background:white;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .status-dot{
      width:8px;height:8px;border-radius:999px;background:#9ca3af;
    }
    .status-dot.connected{ background:#22c55e; }

    .mode-switch{
      padding:4px 10px;
      border:1px solid var(--border-subtle);
      border-radius:999px;
      background:white;
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .mode-switch label{
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .mode-switch input[type="radio"]{ width:12px;height:12px; }

    /* UART settings pills */
    .uart-select{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border-subtle);
      background:white;
      cursor:pointer;
    }
    .uart-label{
      font-size:12px;
      color:var(--text-muted);
      margin-right:2px;
    }
    .uart-group{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
      padding:4px 8px;
      background:white;
      border:1px solid var(--border-subtle);
      border-radius:999px;
    }

    /* METRICS */
    .metric-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-bottom:12px;
    }
    .metric-card{
      background:white;
      border-radius:14px;
      padding:14px;
      border:1px solid var(--border-subtle);
      transition:background .2s ease,border-color .2s ease;
    }
    .metric-card--active{
      background:#fef9c3;
      border-color:#facc15;
    }
    .metric-card.fix-ok{
      background:var(--fix-ok-bg);
      border-color:var(--fix-ok-br);
    }
    .metric-card.fix-bad{
      background:var(--fix-bad-bg);
      border-color:var(--fix-bad-br);
    }
    .metric-header{
      display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;
    }
    .metric-label-row{
      display:flex; align-items:center; gap:6px;
    }
    .mini-needle{
      width:18px;height:18px;
      transform-origin:50% 95%;
      transition:transform .15s ease-out;
    }
    .metric-sublabel{ font-size:12px; color:var(--text-muted); }
    .metric-main{ display:flex; align-items:baseline; gap:6px; }
    .metric-value{ font-size:26px; font-weight:700; }
    .metric-unit{ font-size:12px; color:var(--text-muted); }
    .metric-extra{
      font-size:12px; color:var(--text-muted); margin-top:4px; line-height:1.4;
    }

    /* GPS BAR (one-line) */
    .gps-bar{
      background:white;
      border:1px solid var(--border-subtle);
      border-radius:12px;
      padding:8px 12px;
      font-size:12px;
      color:var(--text-main);
      display:none;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .gps-chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:3px 8px; border-radius:999px; background:#f8fafc; border:1px solid #eef2f7;
      font-size:12px;
    }
    .gps-chip.ok{ background:#ecfdf3; border-color:#86efac; }
    .gps-chip.bad{ background:#f3f4f6; border-color:#e5e7eb; color:#6b7280; }
    .gps-needle{
      width:18px;height:18px; transform-origin:50% 95%;
    }

    /* MAP */
    .map-wrap{
      background:white;
      border-radius:14px;
      border:1px solid var(--border-subtle);
      padding:10px;
      margin-bottom:12px;
      display:none; /* only show in GPS mode */
    }
    .map-toolbar{
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .map-title{
      font-size:13px;
      color:var(--text-muted);
      margin-right:auto;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .track-chip{
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border-subtle);
      background:#fff;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      user-select:none;
    }
    .track-chip .dot{
      width:10px;height:10px;border-radius:999px;display:inline-block;
    }
    .track-chip.raw .dot{ background:var(--raw-red); }
    .track-chip.flt .dot{ background:var(--flt-blue); }
    .track-chip.t15 .dot{ background:#f97316; }
    .track-chip.off{
      opacity:.45;
      text-decoration:line-through;
    }
    .info-btn{
      width:18px;height:18px; border-radius:999px;
      border:1px solid var(--border-subtle);
      display:inline-flex; align-items:center; justify-content:center;
      font-size:12px; color:var(--text-muted); background:white;
      cursor:pointer;
    }

    #map{
      width:100%;
      height:380px;
      border-radius:10px;
      overflow:hidden;
    }
    .leaflet-container{ font: inherit; }

    /* custom arrow marker */
    .arrow-marker{
      width:18px; height:18px; position:relative;
      transform-origin:50% 50%;
    }
    .arrow-marker::before{
      content:"";
      position:absolute; left:50%; top:2px;
      width:0; height:0;
      border-left:5px solid transparent;
      border-right:5px solid transparent;
      border-bottom:10px solid var(--flt-blue);
      transform:translateX(-50%);
    }
    .arrow-marker::after{
      content:"";
      position:absolute; left:50%; top:11px;
      width:6px; height:6px; background:var(--flt-blue);
      border-radius:999px; transform:translateX(-50%);
      box-shadow:0 0 0 2px rgba(59,130,177,.15);
    }
    .arrow-marker.gray::before{ border-bottom-color:#9ca3af; }
    .arrow-marker.gray::after{ background:#9ca3af; box-shadow:none; }

    /* Map legend (bottom right) */
    .legend-box{
      position:absolute;
      right:12px; bottom:12px;
      background:rgba(255,255,255,.95);
      border:1px solid var(--border-subtle);
      border-radius:10px;
      padding:8px 10px;
      font-size:12px;
      display:flex; flex-direction:column; gap:6px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
    }
    .legend-row{
      display:flex; align-items:center; gap:6px;
      color:var(--text-main);
    }
    .legend-line{
      width:18px; height:0; border-top:3px solid;
      border-radius:2px;
    }
    .legend-line.raw{
      border-top-color:var(--raw-red);
      border-top-style:dashed;
    }
    .legend-line.flt{
      border-top-color:var(--flt-blue);
      border-top-style:solid;
    }
    .legend-off{ opacity:.45; text-decoration:line-through; }

    /* PLAYBACK BAR */
    .playback-bar{
      display:none;
      background:white;
      border:1px solid var(--border-subtle);
      border-radius:12px;
      padding:8px 10px;
      margin-bottom:8px;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .playback-bar .btn{ font-size:12px; padding:5px 10px; }
    .playback-meta{
      font-size:12px; color:var(--text-muted);
      margin-right:auto;
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .status-tech{
      font-size:12px;
      color:#4b5563;
    }
    .speed-select{
      font-size:12px; padding:5px 10px; border-radius:999px; border:1px solid var(--border-subtle);
      background:white;
    }

    /* LOG */
    .log-bar{
      display:flex; align-items:center; flex-wrap:wrap; gap:8px; margin-bottom:6px;
    }
    .log-bar-left{ font-size:12px; color:var(--text-muted); }
    .log-bar-right{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-left:auto; width:100%;
    }
    .log-tools-left{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
    }
    .log-spacer{ flex:1; }
    #logSize,#exportFormat{ min-width:110px; }

    #log{
      width:100%;
      border-radius:12px;
      border:1px solid var(--border-subtle);
      padding:10px;
      white-space:pre-wrap;
      overflow-y:auto;
      font-family:monospace;
      font-size:12px;
      background:#050816;
      color:#e5e7eb;
      height:230px;
    }
    #log.log-can{ background:white !important; color:#111827 !important; }

    #warning{
      color:var(--danger);
      font-size:12px;
      margin-top:6px;
      display:none;
    }

    /* MODALS */
    #formatModal,
    #ruleModal{
      position:fixed; inset:0; background:rgba(0,0,0,.45);
      display:none; justify-content:center; align-items:center; z-index:1000;
    }
    #formatModalBox,
    #ruleModalBox{
      width:420px; max-width:calc(100% - 40px);
      background:white; border-radius:12px; padding:16px;
      box-shadow:0 6px 22px rgba(0,0,0,.18);
      position:relative; font-size:12px;
      line-height:1.55;
    }
    #formatClose,#ruleClose{
      position:absolute; right:10px; top:8px; cursor:pointer; color:#6b7280;
    }
    #formatModalBox h4,
    #ruleModalBox h4{ margin:0 0 8px; font-size:14px; }
    #formatModalBox p,
    #ruleModalBox p{ margin:8px 0 4px; }
    #formatModalBox pre{
      background:#f3f4f6; padding:8px; border-radius:6px;
      font-size:12px; overflow-x:auto;
    }
    #ruleModalBox ul{ margin:6px 0 0 18px; padding:0; }

    @media (max-width:640px){
      .toolbar{ align-items:flex-start; }
      .log-bar-right{ margin-left:0; }
      #map{ height:320px; }
      .legend-box{ right:8px; bottom:8px; }
    }
  
  .turn-acc-input{width:52px;margin-left:0;padding:2px 4px;border-radius:6px;border:1px solid rgba(0,0,0,0.12);background:#fff;color:#111827;font-size:12px;vertical-align:middle;text-align:center;}


  .pt-count{font-size:12px;opacity:0.85;margin-left:4px;}


    /* J1939-only page: hide GPS UI components */
    .gps-bar,
    .map-wrap,
    .playback-bar {
      display: none !important;
    }


    /* RN modal (Release Notes) */
    .ver-modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .ver-modal{
      background:#ffffff;
      border-radius:16px;
      max-width:720px;
      width:92%;
      max-height:80vh;
      box-shadow:0 24px 60px rgba(15,23,42,0.45);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .ver-modal-header{
      padding:12px 18px;
      border-bottom:1px solid var(--border-subtle,#e5e7eb);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .ver-modal-title{
      font-size:15px;
      font-weight:700;
      color:#111827;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .ver-modal-title-emoji{
      font-size:18px;
    }
    .ver-modal-close{
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:18px;
      color:#6b7280;
      padding:4px;
      border-radius:999px;
    }
    .ver-modal-close:hover{
      background:rgba(148,163,184,0.18);
    }
    .ver-modal-body{
      padding:12px 18px 14px;
      font-size:13px;
      color:#111827;
      overflow-y:auto;
    }
    .ver-version{
      margin-bottom:12px;
    }
    .ver-tag{
      display:inline-block;
      padding:3px 9px;
      border-radius:999px;
      background:#e5e7eb;
      font-size:12px;
      font-weight:600;
      margin-bottom:4px;
    }
    .ver-tag.ver-latest{
      background:#d1fae5;
      color:#047857;
    }
    .ver-version ul{
      margin:0 0 0 20px;
      padding:0;
    }
    .ver-version li{
      margin:2px 0;
      line-height:1.5;
    }
    @media (max-width:480px){
      .ver-modal{
        width:94%;
        border-radius:14px;
      }
      .ver-modal-body{
        font-size:12px;
      }
    }

</style>
</head>

<body>
  <header class="app-header">
    <div class="app-header-inner">
      <div class="app-logo-title">
        <a href="index_V84_1129.html"><img src="eup-logo.png" class="app-logo" alt="EUP Logo" /></a>
        <div class="app-title">å¼‹æš J1939 æ¸¬è©¦ä»‹é¢<a href="index_V84_1129.html" style="color:white;font-size:13px;border:1px solid #fff;padding:4px 10px;border-radius:8px;text-decoration:none;">è¿”å›é¦–é </a>
      </div>
      </div>
      <div class="page-version" style="display:flex;align-items:center;gap:6px;font-size:14px;color:#9ca3af;font-weight:600;">
        <span id="verLabel">V84_1129</span>
        <span id="verInfo" class="info-btn">i</span>
      </div>
    </div>
  </header>

  <main class="layout">

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="mode-switch">
          <label><input type="radio" name="mode" value="serial" checked> USB-RS232</label>
          <label><input type="radio" name="mode" value="can"> USB-CAN</label>
        </div>
        <div class="uart-group" id="uartGroup" title="UART é€£ç·šåƒæ•¸">
          <span class="uart-label">Baud</span>
          <select id="baudSelect" class="uart-select">
            <option>9600</option><option>19200</option><option>38400</option>
            <option>57600</option><option>115200</option><option>230400</option>
            <option>460800</option><option>921600</option>
          </select>

          <span class="uart-label">Data</span>
          <select id="dataBitsSelect" class="uart-select">
            <option>8</option><option>7</option>
          </select>

          <span class="uart-label">Parity</span>
          <select id="paritySelect" class="uart-select">
            <option value="none" selected>None</option>
            <option value="even">Even</option>
            <option value="odd">Odd</option>
          </select>

          <span class="uart-label">Stop</span>
          <select id="stopBitsSelect" class="uart-select">
            <option>1</option><option>2</option>
          </select>
        </div>

        <button id="connectBtn" class="btn btn-primary">é€£æ¥ COM Port</button>
        <button id="disconnectBtn" class="btn btn-outline" disabled>ä¸­æ–·é€£ç·š</button>

        <div class="status-chip">
          <span id="statusDot" class="status-dot"></span>
          <span id="statusText">å°šæœªé€£ç·š</span>
        </div></div>

      <div class="toolbar-right">
        <button id="demoBtn" class="btn btn-ghost">æ¨¡æ“¬ DEMO</button>
      </div>
    </div>

    <!-- GPS bar (one line) -->
    <div class="gps-bar" id="gpsBar">
      <span class="gps-chip" id="gpsFixChip">å®šä½ <b id="gpsFix">--</b></span>
      <span class="gps-chip">é€Ÿåº¦ <b id="gpsSpeed">--</b> km/h</span>
      
      <span class="gps-chip">æ–¹ä½ <b id="gpsCourse">--</b>Â°</span>
      <span class="gps-chip">æµ·æ‹” <b id="gpsAlt">--</b> m</span>
      <span class="gps-chip">ç·¯åº¦ <b id="gpsLat">--</b></span>
      <span class="gps-chip">ç¶“åº¦ <b id="gpsLon">--</b></span>
      <span class="gps-chip">è¡›æ˜Ÿæ•¸ <b id="gpsSats">--</b></span>
      <span class="gps-chip">HDOP <b id="gpsHdop">--</b></span>
      <span class="gps-chip">æ™‚é–“ <b id="gpsUtc">--</b></span>
      <span class="gps-chip">æ›´æ–° <b id="gpsLocalTs">--</b></span>
    </div>

    <!-- Metrics (8) - for serial/can -->
    <div class="metric-grid" id="metricGrid">
      <div class="metric-card" id="card0">
        <div class="metric-header">
          <div class="metric-label-row">
            <img id="needle0" class="mini-needle"
                 src="data:image/svg+xml;utf8,<svg width='18' height='18' xmlns='http://www.w3.org/2000/svg'><line x1='9' y1='17' x2='9' y2='2' stroke='red' stroke-width='2' stroke-linecap='round'/></svg>">
            <span id="label0">é€Ÿåº¦</span>
          </div>
          <div id="sub0" class="metric-sublabel">PGN 65265 Â· SPN 84</div>
        </div>
        <div class="metric-main">
          <div id="value0" class="metric-value">--</div>
          <div id="unit0" class="metric-unit">km/h</div>
        </div>
        <div id="extra0" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card1">
        <div class="metric-header">
          <div class="metric-label-row">
            <img id="needle1" class="mini-needle"
                 src="data:image/svg+xml;utf8,<svg width='18' height='18' xmlns='http://www.w3.org/2000/svg'><line x1='9' y1='17' x2='9' y2='2' stroke='red' stroke-width='2' stroke-linecap='round'/></svg>">
            <span id="label1">è½‰é€Ÿ</span>
          </div>
          <div id="sub1" class="metric-sublabel">PGN 61444 Â· SPN 190</div>
        </div>
        <div class="metric-main">
          <div id="value1" class="metric-value">--</div>
          <div id="unit1" class="metric-unit">RPM</div>
        </div>
        <div id="extra1" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card2">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label2">é‡Œç¨‹</span></div>
          <div id="sub2" class="metric-sublabel">PGN 65217</div>
        </div>
        <div class="metric-main">
          <div id="value2" class="metric-value">--</div>
          <div id="unit2" class="metric-unit">km</div>
        </div>
        <div id="extra2" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card3">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label3">æ²¹é‡</span></div>
          <div id="sub3" class="metric-sublabel">PGN 65276 Â· SPN 96</div>
        </div>
        <div class="metric-main">
          <div id="value3" class="metric-value">--</div>
          <div id="unit3" class="metric-unit">%</div>
        </div>
        <div id="extra3" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card4">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label4">é›»å£“</span></div>
          <div id="sub4" class="metric-sublabel">PGN 65271 Â· SPN 168</div>
        </div>
        <div class="metric-main">
          <div id="value4" class="metric-value">--</div>
          <div id="unit4" class="metric-unit">V</div>
        </div>
        <div id="extra4" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card5">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label5">æ°´æº«</span></div>
          <div id="sub5" class="metric-sublabel">PGN 65262 Â· SPN 110</div>
        </div>
        <div class="metric-main">
          <div id="value5" class="metric-value">--</div>
          <div id="unit5" class="metric-unit">Â°C</div>
        </div>
        <div id="extra5" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card6">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label6">æ©Ÿæ²¹å£“</span></div>
          <div id="sub6" class="metric-sublabel">PGN 65263 Â· SPN 100</div>
        </div>
        <div class="metric-main">
          <div id="value6" class="metric-value">--</div>
          <div id="unit6" class="metric-unit">kPa</div>
        </div>
        <div id="extra6" class="metric-extra" style="display:none;"></div>
      </div>

      <div class="metric-card" id="card7">
        <div class="metric-header">
          <div class="metric-label-row"><span id="label7">æ²¹è€—ç‡</span></div>
          <div id="sub7" class="metric-sublabel">PGN 65266 Â· SPN 183</div>
        </div>
        <div class="metric-main">
          <div id="value7" class="metric-value">--</div>
          <div id="unit7" class="metric-unit">L/h</div>
        </div>
        <div id="extra7" class="metric-extra" style="display:none;"></div>
      </div>
    </div>

    <!-- PLAYBACK (GPS log import & replay) -->
    <div class="playback-bar" id="playbackBar">
      <div class="playback-meta" id="playbackMeta">
        <span>æª”æ¡ˆï¼š<b id="pbFileName">--</b></span>
        <span>ç¸½ç­†æ•¸ï¼š<b id="pbTotalRecords">0</b></span>
        <span>ç¸½ç§’æ•¸ï¼š<b id="pbTotalSeconds">0</b></span>
      </div>

      <input id="gpsLogInput" type="file" accept=".txt,.csv" style="display:none;" />
      <button id="loadGpsLogBtn" class="btn">è¼‰å…¥ GPS Log</button>

      <button id="pbToStartBtn" class="btn">â® é‡é ­</button>
      <button id="pbPlayBtn" class="btn btn-primary">â–¶ æ’­æ”¾</button>
      <button id="pbPauseBtn" class="btn" disabled>â¸ æš«åœ</button>

      <select id="pbSpeedSelect" class="speed-select">
        <option value="1">1x</option>
        <option value="2">2x</option>
        <option value="5">5x</option>
        <option value="10">10x</option>
        <option value="50">50x</option>
        <option value="100">100x</option>
        <option value="200" selected>200x</option>
        <option value="400">400x</option>
        <option value="800">800x</option>
        <option value="all">All</option>
      </select>

      <button id="pbReplayBtn" class="btn">ğŸ” Replay</button>
      <span class="playback-meta"><span id="pbProgress">0/0</span><span id="allStatus" class="status-tech"></span></span>
    </div>

    <!-- MAP (GPS only) -->
    <div class="map-wrap" id="mapWrap">
      <div class="map-toolbar">
        <div class="map-title">
<span id="rawToggle" class="track-chip raw">
            <span class="dot"></span>
            <span>Raw</span>
            <span id="rawKm">0.00 km</span> <span class="pt-count">ï¼ˆ<b id="rawPts">0</b> é»ï¼‰</span>
          </span>
          <span id="rawInfo" class="info-btn" title="Raw è¦å‰‡">i</span>


          <span id="t15Toggle" class="track-chip t15">
            <span class="dot"></span>
            <span>15s</span>
            <span id="t15Km">0.00 km</span> <span class="pt-count">ï¼ˆ<b id="t15Pts">0</b> é»ï¼‰</span>
          </span>
          <span id="t15Info" class="info-btn" title="15s è¦å‰‡">i</span>

          <span id="fltToggle" class="track-chip flt">
            <span class="dot"></span>
            <span>Filtered</span>
            <span id="fltKm">0.00 km</span> <span class="pt-count">ï¼ˆ<b id="fltPts">0</b> é»ï¼‰</span>
          </span>
          <span id="fltInfo" class="info-btn" title="Filtered è¦å‰‡">i</span>
          <span class="track-chip flt" style="background:#f8fafc;border:1px solid #eef2f7;cursor:default;">
            <span style="margin-right:4px;">é–¥å€¼</span>
            <input id="turnAccTh" type="number" min="50" max="800" step="50" value="500" class="turn-acc-input" />
          </span>
</div>

        <button id="followToggleBtn" class="btn">ğŸ§² è·Ÿéš¨/ç¸®æ”¾ ON</button>
        <button id="darkToggleBtn" class="btn">ğŸŒ™ å¤œé–“</button>
        <button id="clearTrackBtn" class="btn btn-clear">æ¸…é™¤è»Œè·¡</button>
      </div>

      <div id="map" style="position:relative;"></div>
<div id="allOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;justify-content:center;align-items:center;z-index:900;">
  <div id="allOverlayBox" style="background:white;border-radius:12px;padding:16px 20px;box-shadow:0 10px 30px rgba(0,0,0,.25);min-width:260px;max-width:90%;font-size:14px;line-height:1.6;">
    <div id="allOverlayTitle" style="font-weight:600;margin-bottom:6px;">â³ ALL æ¨¡å¼ç¹ªè£½ä¸­</div>
    <div style="margin-bottom:4px;">å·²è™•ç†ï¼š<span id="allCountDone">0</span> / <span id="allCountTotal">0</span></div>
    <div>ç´„ç•¥å®Œæˆåº¦ï¼š<span id="allPercent">0</span>%</div>
  </div>
</div>

    </div>

    <!-- Log controls -->
    <div class="log-bar">
      <div class="log-bar-left">æ¥æ”¶åŸå§‹è³‡æ–™ï¼ˆDebugï¼‰</div>
      <div class="log-bar-right">
        <div class="log-tools-left">
          <select id="logSize" class="btn">
            <option value="small">è¦–çª—å¤§å°ï¼šå°</option>
            <option value="medium" selected>è¦–çª—å¤§å°ï¼šä¸­</option>
            <option value="large">è¦–çª—å¤§å°ï¼šå¤§</option>
          </select>

          <select id="exportFormat" class="btn">
            <option value="txt">æ ¼å¼ï¼šTXT</option>
            <option value="csv">æ ¼å¼ï¼šCSV</option>
          </select>

          <button id="exportBtn" class="btn">åŒ¯å‡º Log</button>
          <button id="formatInfoBtn" class="btn">æ ¼å¼èªªæ˜</button>
        </div>

        <div class="log-spacer"></div>
        <button id="clearLogBtn" class="btn btn-clear">æ¸…é™¤ Log</button>
      </div>
    </div>

    <div id="log"></div>
    <div id="warning"></div>
  </main>

  <!-- Format modal -->
  <div id="formatModal">
    <div id="formatModalBox">
      <div id="formatClose">âœ–</div>
      <h4>æ ¼å¼èªªæ˜</h4>

      <p><b>USB-RS232 æ¨¡å¼ï¼š</b></p>
      <pre>SPD=60;RPM=1500;ODO=123456;FUEL=78;VOLT=24.6;TEMP=85;OILP=320;FRATE=18.5\n</pre>

      <p><b>USB-CAN æ¨¡å¼ï¼ˆJ1939 RAW frameï¼‰ï¼š</b></p>
      <pre>18F00400,8,FF,FF,FF,80,3E,FF,FF,FF</pre>

      <p><b>USB-GPS æ¨¡å¼ï¼ˆNMEA 0183ï¼‰ï¼š</b></p>
      <pre>$GNRMC,021334.00,A,2502.3456,N,12130.5678,E,48.0,123.4,120325,,,A*68</pre>
    </div>
  </div>

  <!-- Rule modal -->
  <div id="ruleModal">
    <div id="ruleModalBox">
      <div id="ruleClose">âœ–</div>
      <h4 id="ruleTitle">è¦å‰‡èªªæ˜</h4>
      <div id="ruleBody"></div>
    </div>
  </div>

<script src="js/app.js"></script>
<script src="js/j1939.js"></script>


  <div id="verModalBackdrop" class="ver-modal-backdrop">
    <div class="ver-modal">
      <div class="ver-modal-header">
        <div class="ver-modal-title">
          <span class="ver-modal-title-emoji">ğŸ“œ</span>
          <span>ç‰ˆæœ¬æ›´æ–°ç´€éŒ„ (Release Notes)</span>
        </div>
        <button type="button" id="verModalCloseBtn" class="ver-modal-close" aria-label="é—œé–‰">âœ•</button>
      </div>
      <div class="ver-modal-body">
                <div class="ver-version">
          <div class="ver-tag">V84_1129ï¼ˆæ­£å¼ç‰ˆï¼‰</div>
          <ul>
            <li>æ–°å¢æ€¥è½‰å‘åµæ¸¬ï¼šæ”¯æ´ Sharp Turn v2.3 æ¼”ç®—æ³•ï¼Œä½¿ç”¨ g1~g4 è¦–çª—èˆ‡åŒå´è½‰å½æ¢ä»¶ï¼Œåœ¨ç¬¬ä¸€å€‹æˆç«‹è¦–çª—çš„ g3 ç•« 1 é¡†ç´…è‰² Sï¼Œä¸¦åŠ å…¥ 10 ç§’å…¨åŸŸå†·å»é¿å…é€£çºŒè§¸ç™¼ã€‚</li>
            <li>æ€¥è½‰å‘çµ±è¨ˆï¼šå³ä¸Šè³‡è¨Šæ¬„æ–°å¢ã€Œæ€¥è½‰å‘ (N é»)ã€ï¼Œå¯çµ±è¨ˆæœ¬æ®µè»Œè·¡åµæ¸¬åˆ°çš„æ€¥è½‰å‘äº‹ä»¶æ•¸é‡ã€‚</li>
            <li>æ¸…é™¤è»Œè·¡æ•´åˆï¼šæŒ‰ä¸‹ã€ŒClear Trackã€æ™‚ï¼ŒæœƒåŒæ­¥æ¸…é™¤æ‰€æœ‰ S icon èˆ‡æ€¥è½‰å‘ç‹€æ…‹ï¼Œä¸å½±éŸ¿ Raw / 15s / Filtered / åœè»Šé‚è¼¯ã€‚</li>
            <li>æ€¥è½‰å‘èªªæ˜ï¼šåœ¨ GPS é é¢çš„æ€¥è½‰å‘ chip æ—æ–°å¢ã€Œâ“˜ã€æŒ‰éˆ•ï¼Œé»æ“Šå¯é–‹å•Ÿæ€¥è½‰å‘è¦å‰‡èªªæ˜ï¼Œæ–¹ä¾¿ UBI èˆ‡é§•é§›ç«¯è§£é‡‹ä½¿ç”¨ã€‚</li>
          </ul>
        </div>

<div class="ver-version">
          <div class="ver-tag">V84_1129ï¼ˆæ­£å¼ç‰ˆï¼‰</div>
          <ul>
            <li>åœè»Šåµæ¸¬èˆ‡ v29 å°é½Šï¼šæ¡ç”¨ 3 km/hã€10mã€20 ç§’èˆ‡ç¬¬ä¸€é» anchor åº§æ¨™ä½œç‚ºåœè»Šäº‹ä»¶ã€‚</li>
            <li>åœè»Šæ™‚é–“æ”¹ç”¨ UTC ç§’æ•¸æ™‚é–“è»¸è¨ˆç®—ï¼ŒPlayback / ALL æ¨¡å¼ä¸‹èˆ‡ v29 åœè»Šé»ä¸€è‡´ã€‚</li>
            <li>æ–°å¢åœè»Š chipã€Œâ“˜ã€è¦å‰‡èªªæ˜ï¼Œç²¾ç°¡åˆ—å‡ºé€Ÿåº¦ / è·é›¢ / æ™‚é–“ / UTC / P icon ç­‰æ¢ä»¶ã€‚</li>
            <li>æ–°å¢åœè»Šç¸½æ™‚é–“çµ±è¨ˆï¼šé¡¯ç¤ºã€Œåœè»Š hh:mm:ss (N é»)ã€ï¼Œç´¯è¨ˆæ‰€æœ‰æœ‰æ•ˆåœè»Šå€æ®µæ™‚é–“ã€‚</li>
          </ul>
        </div>

        <div class="ver-version">
          <div class="ver-tag">v82_1127ï¼ˆæ­£å¼ç‰ˆï¼‰</div>
          <ul>
            <li>çµ±ä¸€ Index / J1939 / GPS ä¸‰é  Header èˆ‡ç‰ˆæœ¬é¡¯ç¤ºï¼ŒRelease Notes æ”¹ç”± RN modal é¡¯ç¤ºã€‚</li>
            <li>GPS èˆ‡ J1939 é çš„ 15 ç§’è»Œè·¡æ”¹ç‚ºç´” RMC UTC ç§’æ•¸æ‰“é»ï¼Œç§»é™¤ dt å¾Œå‚™æ¼”ç®—æ³•ã€‚</li>
            <li>ä¿®æ­£ TXT å›æ”¾æœªå¸¶å…¥ utcTime å°è‡´ 15 ç§’è»Œè·¡ç„¡æ³•é¡¯ç¤ºçš„å•é¡Œï¼ŒGPS / J1939 åŒæ­¥ä¿®æ­£ã€‚</li>
            <li>ä¿®æ­£ gps_v84_test13_1129.js / j1939.js åœ¨ 15 ç§’å€å¡Šçš„å¤§æ‹¬è™ŸéŒ¯èª¤ï¼ˆUnexpected token '}'ï¼‰ï¼Œæå‡ç©©å®šæ€§ã€‚</li>
          </ul>
        </div>

        
        
        
        
                
        <div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>GPS 15 ç§’è»Œè·¡æ”¹ç‚ºå„ªå…ˆä½¿ç”¨ RMC UTC ç§’æ•¸è¨ˆç®—ï¼Œé»æ•¸ç´„ç­‰æ–¼ã€Œç¸½ç§’æ•¸ Ã· 15ã€ã€‚</li>
            <li>è‹¥ UTC è³‡æ–™ç¼ºå¤±æˆ–æ ¼å¼ç•°å¸¸ï¼Œå‰‡é€€å›åŸæœ¬ dt æ¼”ç®—æ³•ï¼Œé¿å… 15s å®Œå…¨ä¸é¡¯ç¤ºã€‚</li>
            <li>æ­¤ç‰ˆæœ¬ç”¨æ–¼æ¯”å° Python é›¢ç·š 15 ç§’å–æ¨£çµæœèˆ‡é é¢é¡¯ç¤ºæ˜¯å¦ä¸€è‡´ã€‚</li>
          </ul>
        </div>
<div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>ä¿®æ­£ RMC åœ°åœ–æ›´æ–°é‡è¤‡æ’å…¥ç”¢ç”Ÿçš„ type ä½œç”¨åŸŸéŒ¯èª¤ã€‚</li>
            <li>ä¿ç•™ GNRMC æ”¯æ´èˆ‡ UTC 15 ç§’æ¼”ç®—æ³•ã€‚</li>
          </ul>
        </div>
<div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>ä¿®æ­£ GPS NMEA è§£ææµç¨‹ï¼ŒRMC é¡å‹çµ±ä¸€ä»¥çµå°¾ã€ŒRMCã€åˆ¤æ–·ï¼Œå®Œæ•´æ”¯æ´ GNRMC è¼¸å‡ºã€‚</li>
            <li>RMC è§£ææ™‚å°‡ UTC æ™‚é–“æ¬„ä½ï¼ˆä¾‹å¦‚ 083753.000ï¼‰è½‰æ›ç‚º HH:MM:SS å½¢å¼ä¸¦å¯«å…¥ gpsState.utcTimeã€‚</li>
            <li>åœ°åœ–èˆ‡ 15s æ¼”ç®—æ³•æ”¹ç‚ºåƒ…åœ¨æ¥æ”¶åˆ° RMC è¨Šæ¯æ™‚è¨ˆç®—èˆ‡ç¹ªè£½ï¼Œç¢ºä¿ 15s å®Œå…¨ä»¥ UTC ç§’æ•¸ç‚ºåŸºæº–ã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>èª¿æ•´ GPS 15s è»Œè·¡æ¼”ç®—æ³•ï¼šå„ªå…ˆä½¿ç”¨ RMC UTC ç§’æ•¸ç´¯ç©ï¼Œè‹¥ UTC è³‡æ–™ç¼ºå¤±å‰‡é€€å›åŸæœ¬ dt é‚è¼¯ã€‚</li>
            <li>é¿å…å›  NMEA æ™‚é–“æ ¼å¼æˆ–ç¼ºæ¼å°è‡´ 15s æ©˜ç·šå®Œå…¨ä¸é¡¯ç¤ºï¼ˆ0 é»ã€0 kmï¼‰çš„ç‹€æ³ã€‚</li>
            <li>åœ¨ UTC æ­£å¸¸æ™‚ï¼Œ15s é»æ•¸ä»ç´„ç­‰æ–¼ã€Œæª”æ¡ˆç¸½ç§’æ•¸ Ã· 15ã€ï¼Œç¢ºä¿å¯ç”¨ log é›¢ç·šé‡ç®—é©—è­‰ã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>èª¿æ•´ GPS 15s è»Œè·¡æ¼”ç®—æ³•ç‚ºã€Œç´” UTC ç§’æ•¸ã€ç‰ˆæœ¬ï¼Œæ¯ç§’ç´¯ç©ï¼Œåœè»Šæ™‚é–“ä¹Ÿè¨ˆå…¥ 15 ç§’ã€‚</li>
            <li>15s é»æ•¸ç´„ç­‰æ–¼ã€Œæª”æ¡ˆç¸½ç§’æ•¸ Ã· 15ã€ï¼Œæ–¹ä¾¿ä½¿ç”¨ log æª”é›¢ç·šé‡ç®—é©—è­‰çµæœã€‚</li>
            <li>Rawï¼Filtered è»Œè·¡èˆ‡æ—¢æœ‰åœè»Šåˆ¤æ–·é‚è¼¯ç¶­æŒä¸è®Šï¼Œåƒ…å½±éŸ¿ 15s æ©˜ç·šèˆ‡å…¶é‡Œç¨‹çµ±è¨ˆã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v82_test5_1127ï¼ˆæ­£å¼ç‰ˆï¼‰</div>
          <ul>
            <li>æ¨™è¨˜ v81 ç‚ºæ­£å¼ç‰ˆï¼Œç¢ºèª J1939 èˆ‡ GPS JavaScript åŠŸèƒ½ç©©å®šï¼ˆDEMOã€Logã€åœ°åœ–ï¼‰ã€‚</li>
            <li>Headerã€Œiã€åœ–ç¤ºæ­£å¼æ›è¼‰ RN modalï¼Œç§»é™¤èˆ‡èˆŠ Rule Modal çš„é—œè¯è¡Œç‚ºã€‚</li>
            <li>æ•´åˆä¸¦æ‰¿æ¥ v81 æ¸¬è©¦ç‰ˆä¿®æ­£å…§å®¹ï¼Œä½œç‚ºå¾ŒçºŒç‰ˆæœ¬é–‹ç™¼çš„ç©©å®šåŸºæº–ã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag ver-latest">v82_test5_1127ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>ä¿®æ­£ RN modal åˆå§‹åŒ–æ™‚æ©Ÿï¼Œç¢ºä¿ Headerã€Œiã€æŒ‰éˆ•åœ¨ä¸‰é çš†å¯æ­£å¸¸é–‹å•Ÿã€‚</li>
            <li>ç§»é™¤èˆŠç‰ˆç‰ˆæœ¬ç´€éŒ„è¦–çª—é‡ç–Šé¡¯ç¤ºå•é¡Œï¼Œé¿å… v77 / v73 / v72 ç­‰æ­·å²å…§å®¹èˆ‡ RN modal åŒæ™‚å‡ºç¾ã€‚</li>
            <li>çµ±ä¸€ RN modal ç‚ºå”¯ä¸€çš„ç‰ˆæœ¬è³‡è¨Šå…¥å£ï¼Œæœªä¾†æ­£å¼ç‰ˆå°‡è‡ªå‹•å¯«å…¥æ­¤è™•ã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v81_test1_1126ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</div>
          <ul>
            <li>æ–°å¢ Headerã€Œiã€æŒ‰éˆ•çš„ç‰ˆæœ¬è³‡è¨Šå½ˆå‡ºè¦–çª—ï¼ˆpopupï¼‰ã€‚</li>
            <li>ç§»é™¤ tooltipï¼Œåªä¿ç•™ä¸­å¤® popup é¡¯ç¤ºå®Œæ•´ Release Notesã€‚</li>
            <li>åŒæ­¥ index / J1939 / GPS ä¸‰é çš„ç‰ˆæœ¬è³‡è¨Šè¡Œç‚ºã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v80_1126ï¼ˆæ­£å¼ç‰ˆï¼‰</div>
          <ul>
            <li>çµ±ä¸€ä¸‰é  Header æ¨£å¼èˆ‡ç‰ˆæœ¬é¡¯ç¤ºã€‚</li>
            <li>é¦–é æ”¹ç‚ºå¡ç‰‡å¼å…¥å£å°å‘ J1939 / GPS æ¸¬è©¦é ã€‚</li>
            <li>é‡æ§‹ JavaScript çµæ§‹ç‚º app.js / j1939.js / gps_v84_test13_1129.jsã€‚</li>
            <li>ä¿®æ­£é€£çµèˆ‡å°è¦½è·¯å¾‘ä¸€è‡´æ€§ï¼Œæ¸…ç†èˆŠç‰ˆç‰ˆæœ¬è™Ÿæ¨™ç¤ºã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v79_xxï¼ˆæ­·å²æ¸¬è©¦ç‰ˆæ¦‚è¿°ï¼‰</div>
          <ul>
            <li>åŠ å…¥ GPS ALL æ¨¡å¼èˆ‡è¼‰å…¥é€²åº¦é¡¯ç¤ºæ¡†ã€‚</li>
            <li>èª¿æ•´ 15 ç§’æ‰“é»èˆ‡ Filtered è»Œè·¡çš„é¡¯ç¤ºèˆ‡æ¼”ç®—æ³•è¡Œç‚ºã€‚</li>
          </ul>
        </div>
        <div class="ver-version">
          <div class="ver-tag">v78_xxï¼ˆæ­·å²æ¸¬è©¦ç‰ˆæ¦‚è¿°ï¼‰</div>
          <ul>
            <li>åˆæ­¥æ‹†åˆ† index / J1939 / GPS ä¸‰é æ¶æ§‹ã€‚</li>
            <li>å»ºç«‹å¡ç‰‡å¼ metrics UI åŠ GPS åœ°åœ–åˆç‰ˆã€‚</li>
          </ul>
        </div>
      </div>
    </div>
  </div>


<script>
document.addEventListener('DOMContentLoaded', function(){
  const infoBtn = document.getElementById('verInfo');
  const backdrop = document.getElementById('verModalBackdrop');
  const closeBtn = document.getElementById('verModalCloseBtn');

  if(!infoBtn || !backdrop){ return; }

  function openModal(){
    backdrop.style.display = 'flex';
  }
  function closeModal(){
    backdrop.style.display = 'none';
  }

  infoBtn.addEventListener('click', openModal);
  if(closeBtn){
    closeBtn.addEventListener('click', closeModal);
  }
  backdrop.addEventListener('click', function(e){
    if(e.target === backdrop){ closeModal(); }
  });
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){ closeModal(); }
  });
});
</script>

</body>
</html>
